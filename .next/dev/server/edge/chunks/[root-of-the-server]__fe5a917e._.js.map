{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/OneDrive/Desktop/Quiz_engine/QuizEngine/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\n\r\n// Role and branch middleware for demonstration only.\r\n// It reads cookies: 'qe-role' and 'qe-branch' and redirects accordingly.\r\n// TODO: Replace this cookie-based check with Supabase auth / server session in production.\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const url = request.nextUrl.clone()\r\n  const role = request.cookies.get('qe-role')?.value ?? ''\r\n  const branch = request.cookies.get('qe-branch')?.value ?? ''\r\n\r\n  // Redirect root dashboard to correct role-based dashboard\r\n  if (url.pathname === '/dashboard' || url.pathname === '/dashboard/') {\r\n    // Admin overrides everything if role is admin\r\n    if (role === 'admin') {\r\n      url.pathname = '/dashboard/admin'\r\n      return NextResponse.redirect(url)\r\n    }\r\n    if (role === 'teacher') {\r\n      url.pathname = '/dashboard/teacher'\r\n      return NextResponse.redirect(url)\r\n    }\r\n    if (role === 'student') {\r\n      // if there's a branch set, map to branch dashboards\r\n      if (branch === 'cse') url.pathname = '/dashboard/student/cse'\r\n      else if (branch === 'mech' || branch === 'mechanical') url.pathname = '/dashboard/student/mech'\r\n      else if (branch === 'civil') url.pathname = '/dashboard/student/civil'\r\n      else url.pathname = '/dashboard/student/cse'\r\n      return NextResponse.redirect(url)\r\n    }\r\n  }\r\n\r\n  // If role tries to access an admin area, block\r\n  if (url.pathname.startsWith('/dashboard/admin') && role !== 'admin') {\r\n    url.pathname = '/dashboard'\r\n    return NextResponse.redirect(url)\r\n  }\r\n\r\n  // Teacher's area protection\r\n  if (url.pathname.startsWith('/dashboard/teacher') && role !== 'teacher' && role !== 'admin') {\r\n    url.pathname = '/dashboard'\r\n    return NextResponse.redirect(url)\r\n  }\r\n\r\n  // Student area protection (route has /dashboard/student/:branch)\r\n  if (url.pathname.startsWith('/dashboard/student')) {\r\n    const pathParts = url.pathname.split('/')\r\n    const branchSegment = pathParts[3] ?? ''\r\n    if (role !== 'student') {\r\n      url.pathname = '/dashboard'\r\n      return NextResponse.redirect(url)\r\n    }\r\n    if (branch && branchSegment && branchSegment !== branch) {\r\n      // Redirect to the student's branch page\r\n      url.pathname = `/dashboard/student/${branch}`\r\n      return NextResponse.redirect(url)\r\n    }\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n  matcher: ['/dashboard/:path*', '/dashboard'],\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAOO,SAAS,WAAW,OAAoB;IAC7C,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;IACjC,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY,SAAS;IACtD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc,SAAS;IAE1D,0DAA0D;IAC1D,IAAI,IAAI,QAAQ,KAAK,gBAAgB,IAAI,QAAQ,KAAK,eAAe;QACnE,8CAA8C;QAC9C,IAAI,SAAS,SAAS;YACpB,IAAI,QAAQ,GAAG;YACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;QACA,IAAI,SAAS,WAAW;YACtB,IAAI,QAAQ,GAAG;YACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;QACA,IAAI,SAAS,WAAW;YACtB,oDAAoD;YACpD,IAAI,WAAW,OAAO,IAAI,QAAQ,GAAG;iBAChC,IAAI,WAAW,UAAU,WAAW,cAAc,IAAI,QAAQ,GAAG;iBACjE,IAAI,WAAW,SAAS,IAAI,QAAQ,GAAG;iBACvC,IAAI,QAAQ,GAAG;YACpB,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,+CAA+C;IAC/C,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,uBAAuB,SAAS,SAAS;QACnE,IAAI,QAAQ,GAAG;QACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,4BAA4B;IAC5B,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,yBAAyB,SAAS,aAAa,SAAS,SAAS;QAC3F,IAAI,QAAQ,GAAG;QACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,iEAAiE;IACjE,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,uBAAuB;QACjD,MAAM,YAAY,IAAI,QAAQ,CAAC,KAAK,CAAC;QACrC,MAAM,gBAAgB,SAAS,CAAC,EAAE,IAAI;QACtC,IAAI,SAAS,WAAW;YACtB,IAAI,QAAQ,GAAG;YACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;QACA,IAAI,UAAU,iBAAiB,kBAAkB,QAAQ;YACvD,wCAAwC;YACxC,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE,QAAQ;YAC7C,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO,oPAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAqB;KAAa;AAC9C"}}]
}