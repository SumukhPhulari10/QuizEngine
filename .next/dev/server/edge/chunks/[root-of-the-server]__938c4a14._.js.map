{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/OneDrive/Desktop/Quiz_engine/QuizEngine/lib/branch-auth.ts"],"sourcesContent":["import type { NextRequest } from \"next/server\"\nimport { cookies } from \"next/headers\"\nimport { NextResponse } from \"next/server\"\nimport { redirect } from \"next/navigation\"\n\nconst normalize = (value: string = \"\") => value.trim().toLowerCase()\n\nexport const BRANCH_ALIASES: Record<string, string[]> = {\n  cse: [\"cse\", \"computer-science\", \"computer science engineering\", \"computer science\"],\n  mech: [\"mech\", \"mechanical\", \"mechanical engineering\"],\n  civil: [\"civil\", \"civil engineering\"],\n  ece: [\"ece\", \"electronics\", \"electronics and communication\"],\n  aiml: [\"aiml\", \"ai-ml\", \"ai\", \"ml\", \"artificial-intelligence\", \"machine-learning\"],\n  it: [\"it\", \"information-technology\", \"information technology\"],\n}\n\nconst STUDENT_SEGMENT = \"student\"\n\nconst resolveBaseUrl = (req?: NextRequest) => {\n  if (req) return req.url\n  return process.env.NEXT_PUBLIC_BASE_URL || \"http://localhost:3000\"\n}\n\nexport const findCanonicalBranch = (branch?: string | null) => {\n  if (!branch) return undefined\n  const normalized = normalize(branch)\n  return Object.entries(BRANCH_ALIASES).find(([, aliases]) => aliases.includes(normalized))?.[0]\n}\n\nconst readCookie = (keys: string[], req?: NextRequest) => {\n  const valueFromRequest = keys\n    .map((key) => req?.cookies?.get(key)?.value)\n    .find((val): val is string => Boolean(val))\n  if (valueFromRequest) return valueFromRequest\n\n  try {\n    const cookieStore = cookies()\n    return (\n      keys\n        .map((key) => cookieStore.get(key)?.value)\n        .find((val): val is string => Boolean(val))\n    ) || \"\"\n  } catch {\n    return \"\"\n  }\n}\n\nexport function getRoleFromRequest(req?: NextRequest) {\n  return normalize(readCookie([\"role\", \"qe-role\"], req))\n}\n\nexport function getBranchFromRequest(req?: NextRequest) {\n  return findCanonicalBranch(readCookie([\"branch\", \"qe-branch\"], req))\n}\n\nexport function redirectToStudentBranch(branch: string, req?: NextRequest) {\n  const canonical = branch?.toLowerCase()\n  const target = `/student/${canonical}/dashboard`\n  const url = new URL(target, resolveBaseUrl(req))\n  return NextResponse.redirect(url)\n}\n\nconst extractBranchFromPath = (pathname: string) => {\n  const segments = pathname.split(\"/\").filter(Boolean)\n  const studentIdx = segments.indexOf(STUDENT_SEGMENT)\n  if (studentIdx === -1) return undefined\n  const branchCandidate = segments[studentIdx + 1]\n  return findCanonicalBranch(branchCandidate)\n}\n\nexport function validateStudentBranchRequest(req: NextRequest) {\n  const role = getRoleFromRequest(req)\n  const branchCookie = getBranchFromRequest(req)\n\n  if (!role) {\n    return NextResponse.redirect(new URL(\"/login\", resolveBaseUrl(req)))\n  }\n\n  if (role !== \"student\") return null\n\n  if (!branchCookie) {\n    return NextResponse.redirect(new URL(\"/login\", resolveBaseUrl(req)))\n  }\n\n  const requestedBranch = extractBranchFromPath(req.nextUrl.pathname)\n\n  if (!requestedBranch || requestedBranch !== branchCookie) {\n    return redirectToStudentBranch(branchCookie, req)\n  }\n\n  return null\n}\n\nexport async function getStudentContext() {\n  const cookieStore = await cookies()\n  const role = normalize(cookieStore.get(\"role\")?.value || cookieStore.get(\"qe-role\")?.value || \"\")\n  const branch = findCanonicalBranch(cookieStore.get(\"branch\")?.value || cookieStore.get(\"qe-branch\")?.value)\n\n  return { role, branch }\n}\n\nexport async function enforceStudentBranch(requiredBranch?: string) {\n  const { role, branch } = await getStudentContext()\n\n  if (!role) {\n    redirect(\"/login\")\n  }\n\n  if (role !== \"student\") {\n    return { role, branch }\n  }\n\n  if (!branch) {\n    redirect(\"/login\")\n  }\n\n  if (requiredBranch && branch !== requiredBranch) {\n    redirect(`/student/${branch}/dashboard`)\n  }\n\n  return { role, branch }\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/OneDrive/Desktop/Quiz_engine/QuizEngine/middleware.js"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { validateStudentBranchRequest, getRoleFromRequest, getBranchFromRequest } from './lib/branch-auth'\n\n// Middleware: Strict branch based protection\n// - If user is a student and tries to access another student's branch route\n//   redirect to the student's branch dashboard.\n// - Redirect '/dashboard' to the correct role-based route.\n// - Admins and teachers aren't restricted by branch.\n\nexport function middleware(request) {\n  const url = request.nextUrl.clone()\n  const role = getRoleFromRequest(request) || ''\n  const branch = getBranchFromRequest(request)\n\n  if (url.pathname === '/dashboard' || url.pathname === '/dashboard/') {\n    if (role === 'admin') {\n      url.pathname = '/dashboard/admin'\n      return NextResponse.redirect(url)\n    }\n    if (role === 'teacher') {\n      url.pathname = '/dashboard/teacher'\n      return NextResponse.redirect(url)\n    }\n    if (role === 'student' && branch) {\n      url.pathname = `/student/${branch}/dashboard`\n      return NextResponse.redirect(url)\n    }\n  }\n\n  if (url.pathname.startsWith('/student/') || url.pathname.startsWith('/dashboard/student')) {\n    const blocked = validateStudentBranchRequest(request)\n    if (blocked) return blocked\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: ['/student/:path*', '/dashboard/:path*', '/dashboard'],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAQO,SAAS,WAAW,OAAO;IAChC,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;IACjC,MAAM,OAAO,IAAA,uMAAkB,EAAC,YAAY;IAC5C,MAAM,SAAS,IAAA,yMAAoB,EAAC;IAEpC,IAAI,IAAI,QAAQ,KAAK,gBAAgB,IAAI,QAAQ,KAAK,eAAe;QACnE,IAAI,SAAS,SAAS;YACpB,IAAI,QAAQ,GAAG;YACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;QACA,IAAI,SAAS,WAAW;YACtB,IAAI,QAAQ,GAAG;YACf,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;QACA,IAAI,SAAS,aAAa,QAAQ;YAChC,IAAI,QAAQ,GAAG,CAAC,SAAS,EAAE,OAAO,UAAU,CAAC;YAC7C,OAAO,oPAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,gBAAgB,IAAI,QAAQ,CAAC,UAAU,CAAC,uBAAuB;QACzF,MAAM,UAAU,IAAA,iNAA4B,EAAC;QAC7C,IAAI,SAAS,OAAO;IACtB;IAEA,OAAO,oPAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAmB;QAAqB;KAAa;AACjE"}}]
}